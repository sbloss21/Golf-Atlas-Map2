<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Atlas - Plan Your Ultimate Golf Trip</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/leaflet.markercluster.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.Default.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background-color: #0a1f1a;
            color: #ffffff;
        }

        /* Header */
        header {
            background-color: #132822;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #1f4037;
        }

        .logo {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: 8px;
            color: #ffffff;
        }

        nav {
            display: flex;
            gap: 40px;
        }

        nav a {
            color: #ffffff;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            transition: color 0.3s;
        }

        nav a:hover {
            color: #d4af37;
        }

        /* Hero Section */
        .hero {
            display: grid;
            grid-template-columns: 1fr 1.2fr;
            min-height: calc(100vh - 80px);
            background-color: #0f2822;
        }

        .hero-content {
            padding: 80px 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .hero h1 {
            font-size: 56px;
            font-weight: 300;
            line-height: 1.2;
            margin-bottom: 40px;
        }

        .hero h1 .highlight {
            color: #d4af37;
            font-weight: 400;
        }

        .search-box {
            position: relative;
            margin-bottom: 30px;
        }

        .search-box input {
            width: 100%;
            padding: 18px 50px 18px 20px;
            background-color: #ffffff;
            border: none;
            border-radius: 4px;
            font-size: 15px;
            color: #132822;
        }

        .search-box input::placeholder {
            color: #6b8f7f;
        }

        .search-icon {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background-color: #132822;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
        }

        .filter-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: transparent;
            border: 1px solid #2d5a4a;
            color: #ffffff;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .filter-toggle:hover {
            background-color: #1a3a2e;
            border-color: #d4af37;
        }

        /* Map Container */
        .map-container {
            position: relative;
            background-color: #1a2f28;
        }

        #map {
            width: 100%;
            height: 100%;
            min-height: 600px;
        }

        .map-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .map-search {
            background-color: #132822;
            padding: 12px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .map-search input {
            background: transparent;
            border: none;
            color: white;
            font-size: 14px;
            width: 300px;
            outline: none;
        }

        .map-search input::placeholder {
            color: #6b8f7f;
        }

        .filter-chip {
            background-color: #132822;
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .filter-chip:hover {
            background-color: #1a3a2e;
        }

        .filter-chip.active {
            background-color: #2d5a4a;
            border: 1px solid #d4af37;
        }

        .filter-chip input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        /* Resort Cards Section */
        .resorts-section {
            padding: 80px 60px;
            background-color: #0a1f1a;
        }

        .section-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .section-label {
            font-size: 13px;
            letter-spacing: 3px;
            color: #6b8f7f;
            text-transform: uppercase;
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 42px;
            font-weight: 300;
            margin-bottom: 20px;
        }

        .section-description {
            font-size: 16px;
            color: #8ba89a;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .resort-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .resort-card {
            background-color: #132822;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s;
            cursor: pointer;
        }

        .resort-card:hover {
            transform: translateY(-5px);
        }

        .resort-image {
            width: 100%;
            height: 240px;
            object-fit: cover;
        }

        .resort-info {
            padding: 25px;
        }

        .resort-name {
            font-size: 20px;
            font-weight: 600;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: #d4af37;
            margin-bottom: 12px;
        }

        .resort-courses {
            font-size: 14px;
            color: #8ba89a;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .resort-meta {
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 13px;
            color: #6b8f7f;
            margin-bottom: 20px;
        }

        .resort-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .meta-icon {
            width: 12px;
            height: 12px;
            background-color: #2d5a4a;
            border-radius: 50%;
        }

        .learn-more-btn {
            background-color: #2d5a4a;
            color: #ffffff;
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 13px;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
        }

        .learn-more-btn:hover {
            background-color: #3a7058;
        }

        /* Custom Leaflet Popup */
        .leaflet-popup-content-wrapper {
            background-color: #132822;
            color: white;
            border-radius: 8px;
            padding: 0;
        }

        .leaflet-popup-content {
            margin: 0;
            width: 320px !important;
        }

        .popup-content {
            padding: 20px;
        }

        .popup-title {
            font-size: 18px;
            font-weight: 600;
            color: #d4af37;
            margin-bottom: 8px;
        }

        .popup-location {
            font-size: 13px;
            color: #8ba89a;
            margin-bottom: 15px;
        }

        .popup-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }

        .popup-detail {
            background-color: #1a3a2e;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }

        .popup-detail-value {
            font-size: 16px;
            font-weight: 600;
            color: #d4af37;
        }

        .popup-detail-label {
            font-size: 11px;
            color: #6b8f7f;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .popup-info {
            font-size: 13px;
            color: #8ba89a;
            line-height: 1.5;
            margin-top: 10px;
        }

        .popup-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .popup-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .popup-btn-primary {
            background-color: #2d5a4a;
            color: white;
        }

        .popup-btn-primary:hover {
            background-color: #3a7058;
        }

        /* Custom marker styles */
        .custom-marker {
            background-color: #2d5a4a;
            border: 3px solid #d4af37;
            border-radius: 50% 50% 50% 0;
            width: 30px;
            height: 30px;
            transform: rotate(-45deg);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .custom-marker.top100 {
            background-color: #d4af37;
            border-color: #fff;
        }

        @media (max-width: 1024px) {
            .hero {
                grid-template-columns: 1fr;
            }
            
            .map-container {
                min-height: 500px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">GOLF ATLAS</div>
        <nav>
            <a href="#map">MAP</a>
            <a href="#resorts">RESORTS</a>
            <a href="#planner">TRIP PLANNER</a>
            <a href="#about">ABOUT</a>
            <a href="#blog">BLOG</a>
        </nav>
    </header>

    <!-- Hero Section -->
    <div class="hero">
        <div class="hero-content">
            <h1>Plan Your <span class="highlight">Ultimate<br>Golf Trip</span></h1>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search courses, resorts, or destinations">
                <div class="search-icon">üîç</div>
            </div>
            <button class="filter-toggle" id="filterToggle">
                ‚öôÔ∏è Show Filters
            </button>
        </div>
        <div class="map-container">
            <div class="map-controls">
                <div class="map-search">
                    <span>üîç</span>
                    <input type="text" id="mapSearch" placeholder="Search course, city, or state...">
                </div>
                <div class="filter-chip" id="top100Filter">
                    <input type="checkbox" id="top100Check">
                    <label for="top100Check">Show Top-100 Only</label>
                </div>
            </div>
            <div id="map"></div>
        </div>
    </div>

    <!-- Resorts Section -->
    <section class="resorts-section" id="resorts">
        <div class="section-header">
            <div class="section-label">Trip Inspiration</div>
            <h2 class="section-title">Top Golf Resorts in America</h2>
            <p class="section-description">
                Bucket-list destinations every golfer should experience.<br>
                Complete with world-class courses, on-site lodging,<br>
                and unforgettable views.
            </p>
        </div>
        <div class="resort-grid" id="resortGrid"></div>
    </section>

    <script>
        let map, markersLayer;
        let allCourses = [];
        let filteredCourses = [];

        // Initialize map
        function initMap() {
            map = L.map('map', {
                zoomControl: true,
                scrollWheelZoom: true
            }).setView([39.8283, -98.5795], 5);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 18
            }).addTo(map);

            markersLayer = L.markerClusterGroup({
                maxClusterRadius: 50,
                iconCreateFunction: function(cluster) {
                    return L.divIcon({
                        html: '<div style="background-color:#2d5a4a;color:white;border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;font-weight:bold;border:3px solid #d4af37;">' + cluster.getChildCount() + '</div>',
                        className: 'custom-cluster-icon',
                        iconSize: L.point(40, 40)
                    });
                }
            });

            map.addLayer(markersLayer);
        }

        // Load and parse CSV
        async function loadCourses() {
            try {
                const data = await window.fs.readFile('Golf_Atlas_Build_Progress_Tracker 1.xlsx  Course_Data 12.csv', { encoding: 'utf8' });
                const lines = data.split('\n');
                const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
                
                allCourses = lines.slice(1)
                    .filter(line => line.trim())
                    .map(line => {
                        const values = [];
                        let current = '';
                        let inQuotes = false;
                        
                        for (let char of line) {
                            if (char === '"') {
                                inQuotes = !inQuotes;
                            } else if (char === ',' && !inQuotes) {
                                values.push(current.trim().replace(/"/g, ''));
                                current = '';
                            } else {
                                current += char;
                            }
                        }
                        values.push(current.trim().replace(/"/g, ''));
                        
                        const course = {};
                        headers.forEach((header, i) => {
                            course[header] = values[i] || '';
                        });
                        return course;
                    })
                    .filter(course => course.latitude && course.longitude && 
                            !isNaN(parseFloat(course.latitude)) && !isNaN(parseFloat(course.longitude)));

                filteredCourses = [...allCourses];
                displayMarkers();
                displayResortCards();
            } catch (error) {
                console.error('Error loading courses:', error);
            }
        }

        // Display markers on map
        function displayMarkers() {
            markersLayer.clearLayers();

            filteredCourses.forEach(course => {
                const lat = parseFloat(course.latitude);
                const lng = parseFloat(course.longitude);
                
                if (isNaN(lat) || isNaN(lng)) return;

                const isTop100 = course.top_100_ranking && course.top_100_ranking.trim() !== '';
                
                const icon = L.divIcon({
                    className: 'custom-div-icon',
                    html: `<div class="custom-marker ${isTop100 ? 'top100' : ''}"></div>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 30]
                });

                const marker = L.marker([lat, lng], { icon: icon });
                
                const popupContent = createPopupContent(course);
                marker.bindPopup(popupContent, {
                    maxWidth: 320,
                    className: 'custom-popup'
                });

                markersLayer.addLayer(marker);
            });
        }

        // Create popup content
        function createPopupContent(course) {
            return `
                <div class="popup-content">
                    <div class="popup-title">${course.course_name || 'Course Name'}</div>
                    <div class="popup-location">${course.City || ''}, ${course.state || ''}</div>
                    
                    <div class="popup-details">
                        ${course.par ? `
                            <div class="popup-detail">
                                <div class="popup-detail-value">${course.par}</div>
                                <div class="popup-detail-label">Par</div>
                            </div>
                        ` : ''}
                        ${course['yardage(black_tees)'] ? `
                            <div class="popup-detail">
                                <div class="popup-detail-value">${course['yardage(black_tees)']}</div>
                                <div class="popup-detail-label">Yards</div>
                            </div>
                        ` : ''}
                        ${course.top_100_ranking ? `
                            <div class="popup-detail">
                                <div class="popup-detail-value">#${course.top_100_ranking}</div>
                                <div class="popup-detail-label">Top 100</div>
                            </div>
                        ` : ''}
                        ${course['Player Reviews (Avg Rating)'] ? `
                            <div class="popup-detail">
                                <div class="popup-detail-value">${course['Player Reviews (Avg Rating)']}</div>
                                <div class="popup-detail-label">Rating</div>
                            </div>
                        ` : ''}
                    </div>
                    
                    ${course.architect ? `<div class="popup-info">üèóÔ∏è ${course.architect}</div>` : ''}
                    ${course['cost_per_course(green_fee_range)'] ? `<div class="popup-info">üí∞ ${course['cost_per_course(green_fee_range)']}</div>` : ''}
                    
                    <div class="popup-actions">
                        ${course.website_url ? `<button class="popup-btn popup-btn-primary" onclick="window.open('${course.website_url}', '_blank')">Visit Website</button>` : ''}
                        ${course.phone ? `<button class="popup-btn popup-btn-primary" onclick="window.open('tel:${course.phone}')">Call</button>` : ''}
                    </div>
                </div>
            `;
        }

        // Display resort cards
        function displayResortCards() {
            const resortGrid = document.getElementById('resortGrid');
            const featured = filteredCourses
                .filter(c => c['buddies_trip_hotspot (yes_no)'] === 'Yes' || c.top_100_ranking)
                .slice(0, 4);

            let html = '';
            featured.forEach(course => {
                const imgSrc = course.thumbnail_url || 'https://images.unsplash.com/photo-1587174486073-ae5e5cff23aa?w=800';
                const name = course.course_resort || course.course_name;
                const courseName = course.course_name;
                const lat = course.latitude;
                const lng = course.longitude;
                
                html += '<div class="resort-card">';
                html += '<img src="' + imgSrc + '" alt="' + courseName + '" class="resort-image" onerror="this.src=\'https://images.unsplash.com/photo-1587174486073-ae5e5cff23aa?w=800\'">';
                html += '<div class="resort-info">';
                html += '<div class="resort-name">' + name + '</div>';
                html += '<div class="resort-courses">' + courseName + '</div>';
                html += '<div class="resort-meta">';
                
                if (course['lodging_on-site(yes_no)'] === 'Yes') {
                    html += '<div class="resort-meta-item"><span class="meta-icon"></span> On-site Lodging</div>';
                }
                if (course['peak_season/best_time_to_visit']) {
                    html += '<div class="resort-meta-item"><span class="meta-icon"></span> Best: ' + course['peak_season/best_time_to_visit'] + '</div>';
                }
                if (course['cost_per_course(green_fee_range)']) {
                    html += '<div class="resort-meta-item"><span class="meta-icon"></span> ' + course['cost_per_course(green_fee_range)'] + '</div>';
                }
                
                html += '</div>';
                html += '<button class="learn-more-btn" onclick="focusCourse(' + lat + ', ' + lng + ')">Learn More</button>';
                html += '</div>';
                html += '</div>';
            });
            
            resortGrid.innerHTML = html;
        }

        // Focus on specific course
        function focusCourse(lat, lng) {
            map.setView([lat, lng], 13);
            document.getElementById('map').scrollIntoView({ behavior: 'smooth' });
        }

        // Search functionality
        document.getElementById('mapSearch').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            filteredCourses = allCourses.filter(course => 
                course.course_name?.toLowerCase().includes(term) ||
                course.City?.toLowerCase().includes(term) ||
                course.state?.toLowerCase().includes(term) ||
                course.region?.toLowerCase().includes(term)
            );
            displayMarkers();
        });

        // Top 100 filter
        document.getElementById('top100Check').addEventListener('change', (e) => {
            if (e.target.checked) {
                filteredCourses = allCourses.filter(course => course.top_100_ranking && course.top_100_ranking.trim() !== '');
            } else {
                filteredCourses = [...allCourses];
            }
            displayMarkers();
        });

        // Initialize
        initMap();
        loadCourses();
    </script>
</body>
</html>
